<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Server Main View</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script type="text/javascript" src="../assests/js/fontAwesome-all.js"></script>
	<script type="text/javascript" src="../assests/js/CSInterface.js"></script>

	<!--Socket IO-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.slim.js"></script>

	<script>

		var checkNodeConnection = function () {
			if (typeof (require) !== 'undefined') {
				console.log("Node.js is enabled");
			} else {
				console.log("Node.js is disabled");
			}
		}
		var csInterface = new CSInterface();

		// var createSocketIOConnection = require('./assests/socketIO');
		// var createSocketIOServer = require('./assests/socketIO-server.js');
		// createSocketIOConnection.initSocketIO(csInterface);
		// var callbackFunctions = { createServer: createSocketIOConnection.evalScript };
		// var createHttpServer = require('./assests/httpServer')(callbackFunctions);


		/**********************************************************************/
		/*                    Connect to NodeServer 		         	     */
		/**********************************************************************/

		var socket = io.connect('http://127.0.0.1:5200');

		socket.on("handshake", function (res) {
			console.log(res.text)
			socket.emit('ack-handshake', { text: 'hello from client' })
		})

		socket.on("getSelected", function (res) {
			csInterface.evalScript("getSelection()", function (selectedObj) {
				console.log(selectedObj);
				socket.emit('getSelected-ans', { selectedString: selectedObj });
			});
		})


		socket.on("selectedToClient", function (svgCode) {
			sendSvgToClient(svgCode);
		})


		/**********************************************************************/
		/*                    Connect to Client 		         	     */
		/**********************************************************************/
		var http = require('http');

		function sendSvgToClient(svgCode) {

			// var postData = svgCode.toString();

			var options = {
				port: 6432,
				path: "/selectedToClient",
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					// 'Content-Length': Buffer.byteLength(postData).toString()
				}
			};

			var req = http.request(options, function (res) {
				// console.log('STATUS: ${res.statusCode}');
				// console.log('HEADERS: ${JSON.stringify(res.headers)}');
				res.setEncoding('utf8');
				res.on('data', function (chunk) {
					// console.log('BODY: ${chunk}');
				});
				res.on('end', function () {
					// console.log('No more data in response.');
				});
			});

			req.on('error', function (e) {
				console.error('problem with request: ${e.message}');
			});

			// Write data to request body
			// console.log(svgCode)
			req.write(svgCode);
			req.end();
			// http.post("http://localhost:6432/selectedToClient", svgCode, function (res) {
			// 	res.setEncoding('utf8');
			// 	res.on('data', function (body) {
			// 		console.log(body);
			// 	});
			// 	alert("Got response: " + res.statusCode);
			// 	console.log(res);
			// }).on('error', function (e) {
			// 	console.log("Got error: " + e.message);
			// });
		}
		var assign = require('object.assign').getPolyfill(); // returns native method if compliant
		Object.assign = assign;
		// console.log(Object.assign)
		var os = require('os');
		console.log(os);
		console.log(os.tmpDir());
		os.tmpdir = os.tmpDir;

		var fs = require('fs');
		// fs.writeFileSync('D:\\hello.txt', "hi", {
		// encoding: 'utf8',
		// mode: parseInt('600', 8),
		// });

		// console.log(fs.writeFileSync);
		// fs.writeFileSync('D:\\hello.txt', 'utf82', 'utf8')
		//polyfill:

		var lastWriteFileSync = fs.writeFileSync;

		function writeFileSync(path, data, options) {
			// var options = getOptions(options, { encoding: 'utf8', mode: 0o666, flag: 'w' });
			// var options = getOptions(options, { encoding: 'utf8', mode: 0o666, flag: 'w' });

			return lastWriteFileSync(path, data, options.encoding);
		}

		fs.writeFileSync = writeFileSync;
		// function writeFileSync (path, data, encoding) {

		var shell = require('shelljs');
		shell.exec('D:\\try.bat');

	</script>
	<title>Server APP</title>
</head>

</html>


<!-- Generator: IDE for SVG 1.0.0  -->
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
	xmlns:a="svgCodeViewerServer" width="350.76px" height="492.87px" viewBox="0 0 350.76 492.87" xml:space="preserve">
	<g>
		<g>
			<g>
				<g>
					<rect id="rect_827b" style="fill:#D9FF04; stroke: #65C7FE; stroke-width: 6; stroke-linecap: round; "
						width="227.59" height="116.29" transform="rotate(-16.34 125.555 87.8) translate(11.76 29.66)" />
					<polygon id="polygon_27b0"
						style="fill:#9C22FF; stroke: #180F0F; stroke-width: 4; stroke-dasharray: 12,10; "
						points="300.26, 206.17 242.06, 167.27 177.06, 193.17 196.06, 125.77 151.36, 71.87 221.26, 69.17 258.76, 9.97 282.96, 75.67 350.76, 92.97 295.76, 136.27 " />
				</g>

				<g>

					<ellipse id="ellipse_7b09"
						style="fill:#950205; stroke: #69FF02; stroke-width: 3.66; stroke-dasharray: 10.9818000793457; "
						cx="106.945" cy="191.25" rx="44.69" ry="58" transform="rotate(-58.68 106.945 191.25)" />
					<circle id="circle_b09b" style="fill:#71FF20; stroke: #8C30FF; stroke-width: 4; " cx="188.36"
						cy="217.17" r="37" />
				</g>
			</g>

			<ellipse id="ellipse_09b4" style="fill:#71FF20; stroke: #8C30FF; stroke-width: 4; " cx="141.56" cy="410.87"
				rx="82" ry="109.5" />
		</g>
	</g>

</svg>